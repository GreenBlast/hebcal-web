<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script>
window['hebcal']=window['hebcal']||{};
window['hebcal'].fcEvents=<%- JSON.stringify(fcEvents) %>;
window['hebcal'].options=<%- JSON.stringify(options) %>;
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('calendar');
  calendarEl.style.display = 'none';
  var events = window['hebcal'].fcEvents;
  var lastEvent = events[events.length - 1];
  var lastEvDate = lastEvent.start;
  var lastYear = parseInt(lastEvDate.substring(0, 4), 10);
  var lastMonth = parseInt(lastEvDate.substring(5, 7), 10);
  var firstOfNextMonth = new Date(lastYear, lastMonth, 1);
  var opts = {
    initialView: 'dayGridMonth',
    headerToolbar: {
      left: 'prev next',
      center: 'title',
      right: '',
    },
    events: events,
    validRange: {
        start: events[0].start.substring(0, 7) + '-01',
        end: firstOfNextMonth,
    },
  };
  var hopts = window['hebcal'].options;
  if (hopts.isHebrewYear || hopts.year != new Date().getFullYear()) {
    opts.initialDate = events[0].start;
  }
  var calendar = window['hebcal'].fullCalendar = new FullCalendar.Calendar(calendarEl, opts);
  var listViewEl = document.getElementById('list-view');
  var toggleMonth = document.getElementById('toggle-month');
  toggleMonth.onchange = function() {
    calendarEl.style.display = this.checked ? 'block' : 'none';
    listViewEl.style.display = this.checked ? 'none' : 'block';
    if (this.checked) { calendar.render(); }
    toggleMonth.blur();
  };
  document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') {
      calendar.prev();
    } else if (e.key === 'ArrowRight') {
      calendar.next();
    }
  });
});
</script>
