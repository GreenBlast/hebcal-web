<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap5@5.10.2/main.global.min.js"></script>
<script>
window['hebcal']=window['hebcal']||{};
window['hebcal'].fcEvents=<%- JSON.stringify(fcEvents) %>;
window['hebcal'].options=<%- JSON.stringify(options) %>;
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('calendar');
  calendarEl.style.display = 'none';
  var events = window['hebcal'].fcEvents;
  var lastEvent = events[events.length - 1];
  var lastEvDate = lastEvent.start;
  var lastYear = parseInt(lastEvDate.substring(0, 4), 10);
  var lastMonth = parseInt(lastEvDate.substring(5, 7), 10);
  var firstOfNextMonth = new Date(lastYear, lastMonth, 1);
  var opts = {
    themeSystem: 'bootstrap5',
    initialView: 'dayGridMonth',
    headerToolbar: {
      left: 'title',
      right: 'prev next',
    },
    events: events,
    validRange: {
        start: events[0].start.substring(0, 7) + '-01',
        end: firstOfNextMonth,
    },
  };
  var hopts = window['hebcal'].options;
  if (hopts.isHebrewYear || hopts.year != new Date().getFullYear()) {
    opts.initialDate = events[0].start;
  }
  var calendar = window['hebcalFullCalendar'] = new FullCalendar.Calendar(calendarEl, opts);
  var listViewEl = document.getElementById('list-view');
  var toggleMonth = document.getElementById('toggle-month');
  toggleMonth.onchange = function() {
    calendarEl.style.display = this.checked ? 'block' : 'none';
    listViewEl.style.display = this.checked ? 'none' : 'block';
    if (this.checked) { calendar.render(); }
    toggleMonth.blur();
  };
  document.addEventListener('keydown', function(e) {
    if (e.keyCode == 37) {
        window['hebcalFullCalendar'].prev();
    } else if (e.keyCode == 39) {
        window['hebcalFullCalendar'].next();
    }
  });
});
</script>
