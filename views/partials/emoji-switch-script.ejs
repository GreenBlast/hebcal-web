<script>
document.addEventListener('DOMContentLoaded', function() {
  var dlURLs = <%- JSON.stringify(url) %>;
  document.querySelectorAll(".emoji-checkbox .form-check-input").forEach(function(el) {
    var inputId = el.id.substring(2);
    el.addEventListener('change', function(event) {
      var btn = document.getElementById(inputId);
      var srcType = btn.dataset.hebcalSrc;
      var suffix = event.target.checked ? '' : '?emoji=0';
      var href = dlURLs[srcType] + suffix;
      if (srcType == 'gcal') {
        href = 'https://www.google.com/calendar/render?cid=' + encodeURIComponent(href);
      } else if (srcType == 'olcom') {
        var httpURL = dlURLs.gcal + suffix;
        href = 'https://outlook.live.com/calendar/addfromweb?url=' +
          encodeURIComponent(httpURL) + '&name=' + encodeURIComponent(dlURLs.title) +
          '&mkt=en-001';
      }
      btn[btn.dataset.hebcalAttr] = href;
    }, false);
  });
});
</script>
