(function(_exports){"use strict";/**
 * hebcal calendar HTML client-side rendering
 * requries jQuery and Day.js
 *
 * Copyright (c) 2021  Michael J. Radwin.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or
 * without modification, are permitted provided that the following
 * conditions are met:
 *  - Redistributions of source code must retain the above
 *    copyright notice, this list of conditions and the following
 *    disclaimer.
 *  - Redistributions in binary form must reproduce the above
 *    copyright notice, this list of conditions and the following
 *    disclaimer in the documentation and/or other materials
 *    provided with the distribution.
 */var hebcalClient={hour12cc:{US:1,CA:1,BR:1,AU:1,NZ:1,DO:1,PR:1,GR:1,IN:1,KR:1,NP:1,ZA:1},getEventClassName:function getEventClassName(_ref){var category=_ref.category,yomtov=_ref.yomtov,link=_ref.link;var className=category;if(yomtov){className+=" yomtov"}if(typeof link==="string"&&link.substring(0,4)==="http"&&link.substring(0,22)!=="https://www.hebcal.com"){className+=" outbound"}return className},transformHebcalEvents:function transformHebcalEvents(events,lang){var self=this;var evts=events.map(function(src){var allDay=!src.date.includes("T");var title=allDay?src.title:src.title.substring(0,src.title.indexOf(":"));var dest={title:title,start:dayjs(src.date),className:self.getEventClassName(src),allDay:allDay};if(src.memo){dest.description=src.memo}if(src.link){dest.url=src.link}if(src.hebrew){dest.hebrew=src.hebrew;if(lang==="h"){dest.title=src.hebrew;dest.className+=" hebrew"}}return dest});if(lang==="ah"||lang==="sh"){var dest=[];evts.forEach(function(evt){dest.push(evt);if(evt.hebrew){var tmp=$.extend({},evt,{title:evt.hebrew,className:"".concat(evt.className," hebrew")});dest.push(tmp)}});evts=dest}return evts},splitByMonth:function splitByMonth(events){var out=[];var prevMonth="";var monthEvents;events.forEach(function(evt){var idxT=evt.date.indexOf("T");var isoDate=idxT==-1?evt.date:evt.date.substring(0,idxT);var month=isoDate.substring(0,isoDate.length-3);if(month!==prevMonth){prevMonth=month;monthEvents=[];out.push({month:month,events:monthEvents})}monthEvents.push(evt)});return out},tableRow:function tableRow(evt){var self=this;var m=dayjs(evt.date);var dt=evt.date;var cat=evt.category;var localeData=window["hebcal"].localeConfig;var lang=window["hebcal"].lang||"s";var isHebrew=lang=="h"||lang=="he"||lang=="he-x-NoNikud";var dateStr0=localeData.weekdaysShort[m.day()]+m.format(" DD ")+localeData.monthsShort[m.month()];var dateStr=isHebrew?"<span lang=\"he\" dir=\"rtl\">".concat(dateStr0,"</span>"):dateStr0;var allDay=!dt.includes("T");var subj=evt.title;var timeStr="";var className=self.getEventClassName(evt);if(cat==="dafyomi"){subj=subj.substring(subj.indexOf(":")+1)}else if(cat==="candles"||cat==="havdalah"){// "Candle lighting: foo" or "Havdalah (42 min): foo"
subj=subj.substring(0,subj.indexOf(":"))}if(!allDay){var cc=window["hebcal"].cconfig.cc;if(typeof self.hour12cc[cc]==="undefined"){timeStr=dt.substring(11,16)}else{var hour=+dt.substring(11,13);var suffix=hour>=12?"pm":"am";if(hour>12){hour=hour-12}var min=dt.substring(14,16);timeStr="".concat(String(hour),":").concat(String(min)).concat(suffix)}}var timeTd=window["hebcal"].cconfig["geo"]==="none"?"":"<td>".concat(timeStr,"</td>");if(isHebrew){subj="<span lang=\"he\" dir=\"rtl\">".concat(subj,"</span>")}else if((lang==="sh"||lang==="ah")&&evt.hebrew){subj+=" / <span lang=\"he\" dir=\"rtl\">".concat(evt.hebrew,"</span>")}if(evt.link){var atitle=evt.memo?" title=\"".concat(evt.memo,"\""):"";subj="<a".concat(atitle," href=\"").concat(evt.link,"\">").concat(subj,"</a>")}return"<tr><td>".concat(dateStr,"</td>").concat(timeTd,"<td><span class=\"table-event ").concat(className,"\">").concat(subj,"</span></td></tr>")},monthHtml:function monthHtml(month){var yearStr=month.month.substring(0,month.month.length-3);var monthStr=month.month.substring(month.month.length-2);var yy=parseInt(yearStr,10);var mm=parseInt(monthStr,10);var dt=new Date(yy,mm-1,1);if(yy<100){dt.setFullYear(yy)}var lang=window["hebcal"].lang||"s";var isHebrew=lang=="h"||lang=="he"||lang=="he-x-NoNikud";var dir=isHebrew?"rtl":"ltr";var divBegin="<div class=\"month-table\" dir=\"".concat(dir,"\">");var divEnd="</div><!-- .month-table -->";var localeData=window["hebcal"].localeConfig;var titleText="".concat(localeData.months[mm-1]," ").concat(yearStr);var titleSpan=isHebrew?"<span lang=\"he\" dir=\"rtl\">".concat(titleText,"</span>"):titleText;var heading="<h3>".concat(titleSpan,"</h3>");var timeColumn=window["hebcal"].cconfig["geo"]==="none"?"":"<col style=\"width:27px\">";// eslint-disable-next-line max-len
var tableHead="<table class=\"table table-striped\" dir=\"".concat(dir,"\"><col style=\"width:116px\">").concat(timeColumn,"<col><tbody>");var tableFoot="</tbody></table>";var tableContents=month.events.map(this.tableRow.bind(this));return divBegin+heading+tableHead+tableContents.join("")+tableFoot+divEnd},renderMonthTables:function renderMonthTables(){var self=this;if(typeof window["hebcal"].monthTablesRendered==="undefined"){var months=self.splitByMonth(window["hebcal"].events);months.forEach(function(month){var html=self.monthHtml(month);var selector="#cal-".concat(month.month," .agenda");document.querySelectorAll(selector).forEach(function(el){el.innerHTML=html})});window["hebcal"].monthTablesRendered=true}},createCityTypeahead:function createCityTypeahead(autoSubmit){var hebcalCities=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,identify:function identify(obj){return obj.id},remote:{url:"/complete.php?q=%QUERY",wildcard:"%QUERY"}});hebcalCities.initialize();var clearGeo=function clearGeo(){$("#geo").val("none");$("#c").val("off");$("#geonameid").val("");$("#zip").val("");$("#city").val("")};$("#city-typeahead").typeahead({autoselect:true},{name:"hebcal-city",displayKey:"value",source:hebcalCities.ttAdapter(),limit:8,templates:{empty:function empty(_ref2){var query=_ref2.query;var encodedStr=query.replace(/[\u00A0-\u9999<>\&]/gim,function(i){return"&#".concat(i.charCodeAt(0),";")});return"<div class=\"tt-suggestion\">Sorry, no city names match <b>".concat(encodedStr,"</b>.</div>")},suggestion:function suggestion(ctx){if(typeof ctx.geo==="string"&&ctx.geo=="zip"){var flag=ctx.flag?" "+ctx.flag:"";return"<p>".concat(ctx.asciiname,", ").concat(ctx.admin1," <strong>").concat(ctx.id,"</strong> - United States").concat(flag,"</p>")}else{var ctry=ctx.country&&ctx.country=="United Kingdom"?"UK":ctx.country;var ctryStr=ctry||"";var s="<p><strong>".concat(ctx.asciiname,"</strong>");if(ctry&&typeof ctx.admin1==="string"&&ctx.admin1.length>0&&ctx.admin1.indexOf(ctx.asciiname)!=0){ctryStr="".concat(ctx.admin1,", ").concat(ctryStr)}if(ctryStr){ctryStr=" - <small>".concat(ctryStr,"</small>")}var _flag=ctx.flag?" "+ctx.flag:"";return"".concat(s).concat(ctryStr).concat(_flag,"</p>")}}}}).bind("typeahead:render",function(ev,suggestions,isAsync,name){if(suggestions.length==1){var suggestion=suggestions[0];if(typeof suggestion.geo=="string"&&suggestion.geo=="zip"){$("#geo").val("zip");$("#zip").val(suggestion.id)}else{$("#geo").val("geoname");$("#geonameid").val(suggestion.id)}$("#c").val("on")}}).bind("typeahead:select",function(ev,suggestion,name){if(typeof suggestion.geo==="string"&&suggestion.geo=="zip"){clearGeo();$("#geo").val("zip");$("#zip").val(suggestion.id);$("#c").val("on")}else{clearGeo();$("#geo").val("geoname");$("#geonameid").val(suggestion.id);$("#c").val("on")}if(autoSubmit){$("#shabbat-form").submit()}}).bind("keyup keypress",function(e){if(!autoSubmit&&!$(this).val()){clearGeo()}// if we get a 5-digit zip, don't require user to select typeahead result
var val0=$("#city-typeahead").typeahead("val");var val=typeof val0==="string"?val0.trim():"";var firstCharCode=val.charCodeAt(0);var numericRe=/^\d\d\d\d\d/;if(firstCharCode>=48&&firstCharCode<=57&&numericRe.test(val)){var zip5=val.substring(0,5);$("#geo").val("zip");$("#zip").val(zip5);$("#c").val("on");$("#geonameid").val("");$("#city").val("")}var code=e.keyCode||e.which;if(code==13){if(val.length==5&&numericRe.test(val)){return true;// allow form to submit
}e.preventDefault();return false}}).bind("focus",function(e){$(this).typeahead("val","");clearGeo()})}};_exports.hebcalClient=hebcalClient})(this);

