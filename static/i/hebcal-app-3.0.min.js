(function(_exports){"use strict";/**
 * hebcal calendar HTML client-side rendering
 * requries jQuery and Day.js
 *
 * Copyright (c) 2021  Michael J. Radwin.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or
 * without modification, are permitted provided that the following
 * conditions are met:
 *  - Redistributions of source code must retain the above
 *    copyright notice, this list of conditions and the following
 *    disclaimer.
 *  - Redistributions in binary form must reproduce the above
 *    copyright notice, this list of conditions and the following
 *    disclaimer in the documentation and/or other materials
 *    provided with the distribution.
 */var hebcalClient={hour12cc:{US:1,CA:1,BR:1,AU:1,NZ:1,DO:1,PR:1,GR:1,IN:1,KR:1,NP:1,ZA:1},getEventClassName:function getEventClassName(_ref){var category=_ref.category,yomtov=_ref.yomtov,link=_ref.link;var className=category;if(yomtov){className+=" yomtov"}if(typeof link==="string"&&link.substring(0,4)==="http"&&link.substring(0,22)!=="https://www.hebcal.com"){className+=" outbound"}return className},transformHebcalEvents:function transformHebcalEvents(events,lang){var self=this;var evts=events.map(function(src){var allDay=!src.date.includes("T");var title=allDay?src.title:src.title.substring(0,src.title.indexOf(":"));var dest={title:title,start:dayjs(src.date),className:self.getEventClassName(src),allDay:allDay};if(src.memo){dest.description=src.memo}if(src.link){dest.url=src.link}if(src.hebrew){dest.hebrew=src.hebrew;if(lang==="h"){dest.title=src.hebrew;dest.className+=" hebrew"}}return dest});if(lang==="ah"||lang==="sh"){var dest=[];evts.forEach(function(evt){dest.push(evt);if(evt.hebrew){var tmp=$.extend({},evt,{title:evt.hebrew,className:"".concat(evt.className," hebrew")});dest.push(tmp)}});evts=dest}return evts},splitByMonth:function splitByMonth(events){var out=[];var prevMonth="";var monthEvents;events.forEach(function(evt){var m=dayjs(evt.date);var month=m.format("YYYY-MM");if(month!==prevMonth){prevMonth=month;monthEvents=[];out.push({month:month,events:monthEvents})}monthEvents.push(evt)});return out},tableRow:function tableRow(evt){var self=this;var m=dayjs(evt.date);var dt=evt.date;var cat=evt.category;var localeData=window["hebcal"].localeConfig;var dateStr=localeData.weekdaysShort[m.day()]+m.format(" DD ")+localeData.monthsShort[m.month()];var allDay=!dt.includes("T");var lang=window["hebcal"].lang||"s";var subj=evt.title;var timeStr="";var className=self.getEventClassName(evt);if(cat==="dafyomi"){subj=subj.substring(subj.indexOf(":")+1)}else if(cat==="candles"||cat==="havdalah"){// "Candle lighting: foo" or "Havdalah (42 min): foo"
subj=subj.substring(0,subj.indexOf(":"))}if(!allDay){var cc=window["hebcal"].cconfig.cc;if(typeof self.hour12cc[cc]==="undefined"){timeStr=dt.substring(11,16)}else{var hour=+dt.substring(11,13);var suffix=hour>=12?"pm":"am";if(hour>12){hour=hour-12}var min=dt.substring(14,16);timeStr="".concat(String(hour),":").concat(String(min)).concat(suffix)}}var timeTd=window["hebcal"].cconfig["geo"]==="none"?"":"<td>".concat(timeStr,"</td>");if(evt.hebrew){var hebrewHtml="<span lang=\"he\" dir=\"rtl\">".concat(evt.hebrew,"</span>");if(lang=="h"){subj=hebrewHtml}else if(lang.includes("h")){subj+=" / ".concat(hebrewHtml)}}if(evt.link){var atitle=evt.memo?" title=\"".concat(evt.memo,"\""):"";subj="<a".concat(atitle," href=\"").concat(evt.link,"\">").concat(subj,"</a>")}return"<tr><td>".concat(dateStr,"</td>").concat(timeTd,"<td><span class=\"table-event ").concat(className,"\">").concat(subj,"</span></td></tr>")},monthHtml:function monthHtml(month){var date="".concat(month.month,"-01");var m=dayjs(date);var lang=window["hebcal"].lang||"s";var dir=lang==="h"?"rtl":"ltr";var divBegin="<div class=\"month-table\" dir=\"".concat(dir,"\">");var divEnd="</div><!-- .month-table -->";var localeData=window["hebcal"].localeConfig;var heading="<h3>".concat(localeData.months[m.month()]," ").concat(m.format("YYYY"),"</h3>");var timeColumn=window["hebcal"].cconfig["geo"]==="none"?"":"<col style=\"width:27px\">";// eslint-disable-next-line max-len
var tableHead="<table class=\"table table-striped\" dir=\"".concat(dir,"\"><col style=\"width:116px\">").concat(timeColumn,"<col><tbody>");var tableFoot="</tbody></table>";var tableContents=month.events.map(this.tableRow.bind(this));return divBegin+heading+tableHead+tableContents.join("")+tableFoot+divEnd},renderMonthTables:function renderMonthTables(){var self=this;if(typeof window["hebcal"].monthTablesRendered==="undefined"){var months=self.splitByMonth(window["hebcal"].events);months.forEach(function(month){var html=self.monthHtml(month);var selector="#cal-".concat(month.month," .agenda");document.querySelectorAll(selector).forEach(function(el){el.innerHTML=html})});window["hebcal"].monthTablesRendered=true}},createCityTypeahead:function createCityTypeahead(autoSubmit){var hebcalCities=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/complete.php?q=%QUERY",limit:8});hebcalCities.initialize();var clearGeo=function clearGeo(){$("#geo").val("none");$("#c").val("off");$("#geonameid").val("");$("#zip").val("");$("#city").val("")};$("#city-typeahead").typeahead(null,{name:"hebcal-city",displayKey:"value",source:hebcalCities.ttAdapter(),templates:{empty:function empty(_ref2){var query=_ref2.query;var encodedStr=query.replace(/[\u00A0-\u9999<>\&]/gim,function(i){return"&#".concat(i.charCodeAt(0),";")});return"<div class=\"tt-suggestion\">Sorry, no city names match <b>".concat(encodedStr,"</b>.</div>")},suggestion:function suggestion(ctx){if(typeof ctx.geo==="string"&&ctx.geo=="zip"){return"<p>".concat(ctx.asciiname,", ").concat(ctx.admin1," <strong>").concat(ctx.id,"</strong> - United States</p>")}else{var ctry=ctx.country&&ctx.country=="United Kingdom"?"UK":ctx.country;var ctryStr=ctry||"";var s="<p><strong>".concat(ctx.asciiname,"</strong>");if(ctry&&typeof ctx.admin1==="string"&&ctx.admin1.length>0&&ctx.admin1.indexOf(ctx.asciiname)!=0){ctryStr="".concat(ctx.admin1,", ").concat(ctryStr)}if(ctryStr){ctryStr=" - <small>".concat(ctryStr,"</small>")}return"".concat(s+ctryStr,"</p>")}}}}).on("typeahead:selected",function(obj,_ref3,name){var geo=_ref3.geo,id=_ref3.id;if(typeof geo==="string"&&geo=="zip"){$("#geo").val("zip");$("#zip").val(id);if(autoSubmit){$("#geonameid").remove()}else{$("#c").val("on");$("#geonameid").val("");$("#city").val("")}}else{$("#geo").val("geoname");$("#geonameid").val(id);if(autoSubmit){$("#zip").remove()}else{$("#c").val("on");$("#zip").val("");$("#city").val("")}}if(autoSubmit){$("#shabbat-form").submit()}}).bind("keyup keypress",function(e){if(!autoSubmit&&!$(this).val()){clearGeo()}// if we get a 5-digit zip, don't require user to select typeahead result
var val0=$("#city-typeahead").typeahead("val");var val=typeof val0==="string"?val0.trim():"";var numericRe=/^\d+$/;if(val.length==5&&numericRe.test(val)){$("#geo").val("zip");$("#zip").val(val);if(autoSubmit){$("#geonameid").remove()}else{$("#c").val("on");$("#geonameid").val("");$("#city").val("")}}var code=e.keyCode||e.which;if(code==13){if(val.length==5&&numericRe.test(val)){return true;// allow form to submit
}e.preventDefault();return false}}).bind("focus",function(e){$(this).typeahead("val","");clearGeo()})}};_exports.hebcalClient=hebcalClient})(this);

